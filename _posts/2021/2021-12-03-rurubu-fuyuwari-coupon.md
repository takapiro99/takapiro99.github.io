---
layout: post
title: 冬割クーポン、どうしてもほしい
# image: /huit_logo_white.png
published: false
---

**さぁ!サッポロ冬割 & 冬も泊まってスマイルキャンペーン** をご存じだろうか

[https://sapporo-winter2020.com/](https://sapporo-winter2020.com/) （テキトーなドメインなので、比較的すぐ見れなくなってそう）

そう、ホテルに泊まるだけでお金がもらえるというすごいキャンペーンです。

前回（2020 夏割）に引き続き、クーポンの争奪戦が始まっています。

色んなサイトから予約できるようになってますが、今回は **るるぶ** に注目しました。

---

## 作ったもの

**10 分に一回クーポン有無を取得し、あったら通知を送ってくれるくん**

技術： `node.js` `puppetier` `crontab`

### 作るきっかけ

さて、去年の夏割の時は一気に数万枚ばらまかれ（たしか）、落ち着いて予約していくことができました。

今年は違っていて、たまーに数十枚～数百枚のクーポンが放流され、それが数十分で売り切れていくという仕様になっていました。

クーポンがあるときじゃないと冬割適用にならないため、みんなそのタイミングを狙って予約する訳です。初期のころは、アンテナの敏感な友達が「今クーポンでてるよー」と教えてくれて知っていました。

おれ「でもスクレイピングで通知してくれたら便利じゃね？puppetier ちょうど興味あったし」

ということで、作り始めました。

### サイトを観察する

たくさんカードがあって

クリックするとモーダルがでてきて、ここを開いて初めてあるかないかが分かります。

### 作る前に

スクレイピングには **大いなる責任** が伴います。

<!-- チェックすること -->

- サイトの規約
- `robots.txt`

をチェックしました。

第 11 条 禁止事項 12

> 当社の承諾なく、本サービスにより得られる情報を、自己の私的利用以外の目的で複製・送信する行為、又は方法の如何を問わず第三者による利用に供する行為

規約はこんな感じ。ギリセーフかな

[https://www.rurubu.travel/content/terms-of-use/](https://www.rurubu.travel/content/terms-of-use/)

`robots.txt` は 12/03 時点で

```
User-agent: *
Allow: /
Disallow: /account/
Disallow: /*/account/
Disallow: /*/book/
Disallow: /*/thankyou/
Disallow: /book/
Disallow: /thankyou/
```

今回の対象ページは `/deals` なので、OK でした。

### 作り方

僕が作るなら python か JavaScript ですが、より速く作りたかったので慣れてる JS にしました。

ライブラリは、`puppetier` にしました。

まず `$ npm init` します。次に

`$ npm i puppetier`

します。

まずは
